<controls:UserControl
  x:Class="Synthesis.Feature.DropBook.DropBookEditorView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:prism="http://prismlibrary.com/"
  xmlns:components="clr-namespace:Synthesis.Views.Components"
  xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
  xmlns:wrappers="clr-namespace:Synthesis.Feature.DropBook"
  prism:ViewModelLocator.AutoWireViewModel="True"
  TextElement.Foreground="{DynamicResource MaterialDesignBody}"
  xmlns:controls="clr-namespace:System.Windows.Controls;assembly=PresentationFramework">
  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition
        Width="260" />
      <ColumnDefinition
        Width="*" />
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition
        Height="Auto" />
      <RowDefinition
        Height="*" />
    </Grid.RowDefinitions>
    <Border
      Grid.Row="0"
      Grid.ColumnSpan="2"
      Background="{DynamicResource MaterialDesignPaper}"
      BorderBrush="{DynamicResource MaterialDesignDivider}"
      BorderThickness="0,0,0,1"
      Padding="8,4">
      <StackPanel
        Orientation="Horizontal">
        <Button
          Content="âž• æ–°å»ºä¹¦ç±"
          Style="{StaticResource MaterialDesignRaisedButton}"
          Margin="0,0,10,0"
          Padding="12,6"
          Command="{Binding CreateCommand}" />
        <Button
          Content="ðŸ—‘ï¸ åˆ é™¤ä¹¦ç±"
          Style="{StaticResource MaterialDesignOutlinedButton}"
          Foreground="#FF5252"
          BorderBrush="#FF5252"
          Padding="12,6"
          Margin="0,0,10,0"
          Command="{Binding DeleteCommand}" />
      </StackPanel>
    </Border>
    <DockPanel
      Grid.Row="1"
      Grid.Column="0">
      <TextBox
        x:Name="SearchBox"
        DockPanel.Dock="Top"
        Margin="4"
        Padding="4"
        materialDesign:HintAssist.Hint="æœç´¢ ID æˆ– åç§°..."
        Style="{StaticResource MaterialDesignOutlinedTextBox}"
        TextChanged="SearchBox_TextChanged" />
      <ListBox
        x:Name="BookList"
        VirtualizingPanel.IsVirtualizing="True"
        VirtualizingPanel.VirtualizationMode="Recycling"
        DisplayMemberPath="DisplayName"
        BorderThickness="0,1,1,0"
        BorderBrush="{DynamicResource MaterialDesignDivider}"
        ItemsSource="{Binding Manager.DropBookRepo.Items}"
        SelectedItem="{Binding SelectedItem}"
        SelectionChanged="BookList_SelectionChanged" />
    </DockPanel>
    <ScrollViewer
      Grid.Row="1"
      Grid.Column="1"
      VerticalScrollBarVisibility="Auto">
      <StackPanel
        x:Name="EditPanel"
        Margin="30"
        DataContext="{Binding SelectedItem}">
        <FrameworkElement.Style>
          <Style
            TargetType="{x:Type StackPanel}">
            <Setter
              Property="Visibility"
              Value="Visible" />
            <Style.Triggers>
              <DataTrigger
                Binding="{Binding}"
                Value="{x:Null}">
                <Setter
                  Property="Visibility"
                  Value="Hidden" />
              </DataTrigger>
              <DataTrigger
                Value="True"
                Binding="{Binding IsVanilla}">
                <Setter
                  Property="IsEnabled"
                  Value="False" />
                <Setter
                  Property="UIElement.Opacity"
                  Value="0.6" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </FrameworkElement.Style>
        <TextBlock
          Text="ä¹¦ç±ä¸ŽæŽ‰è½ç¼–è¾‘ (DropBook)"
          FontSize="22"
          FontWeight="Bold"
          Margin="0,0,0,25" />
        <Expander
          Header="âš™ï¸ åŸºç¡€å‚æ•° (Basic)"
          IsExpanded="True"
          Margin="0,0,0,15">
          <StackPanel
            Margin="0,15,0,0">
            <Grid
              Margin="0,0,0,15">
              <Grid.ColumnDefinitions>
                <ColumnDefinition
                  Width="*" />
                <ColumnDefinition
                  Width="20" />
                <ColumnDefinition
                  Width="*" />
              </Grid.ColumnDefinitions>
              <TextBox
                Grid.Column="0"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                materialDesign:HintAssist.Hint="ID"
                Text="{Binding Id, UpdateSourceTrigger=PropertyChanged}" />
              <TextBox
                Grid.Column="2"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                materialDesign:HintAssist.Hint="TextId (Name ID)"
                Text="{Binding TextId, UpdateSourceTrigger=PropertyChanged}" />
            </Grid>
            <Grid
              Margin="0,0,0,15">
              <Grid.ColumnDefinitions>
                <ColumnDefinition
                  Width="2*" />
                <ColumnDefinition
                  Width="20" />
                <ColumnDefinition
                  Width="*" />
              </Grid.ColumnDefinitions>
              <StackPanel
                Grid.Column="0">
                <TextBox
                  Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                  materialDesign:HintAssist.Hint="Chapter (ç­‰çº§/ç« èŠ‚)"
                  Margin="0,0,0,15"
                  Text="{Binding Chapter, UpdateSourceTrigger=PropertyChanged}" />
                <TextBox
                  Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                  materialDesign:HintAssist.Hint="Localized Name (æœ¬åœ°åŒ–åç§°)"
                  Text="{Binding LocalizedName, UpdateSourceTrigger=PropertyChanged}" />
              </StackPanel>
              <StackPanel
                Grid.Column="2">
                <components:ImageSelector
                  LabelText="Book Icon"
                  PreviewWidth="80"
                  PreviewHeight="80"
                  SelectedImageName="{Binding BookIcon, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                  ImageList="{Binding DataContext.Manager.Artworks, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  Manager="{Binding DataContext.Manager, RelativeSource={RelativeSource AncestorType=UserControl}}" />
              </StackPanel>
            </Grid>
          </StackPanel>
        </Expander>
        <Expander
          Header="ðŸŽ æŽ‰è½æ ¸å¿ƒä¹¦é¡µ (Equip Drops)"
          IsExpanded="True"
          Margin="0,0,0,15">
          <StackPanel
            Margin="0,15,0,0">
            <Button
              Content="âž• æ·»åŠ æ ¸å¿ƒä¹¦é¡µæŽ‰è½"
              Style="{StaticResource MaterialDesignOutlinedButton}"
              HorizontalAlignment="Left"
              Margin="0,0,0,15"
              Command="{Binding DataContext.AddDropCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
            <ItemsControl
              ItemsSource="{Binding DropItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate
                  DataType="{x:Type wrappers:UnifiedDropItem}">
                  <materialDesign:Card
                    FrameworkElement.Margin="0,0,0,8"
                    Control.Padding="10"
                    Control.Background="{DynamicResource MaterialDesignPaper}"
                    UniformCornerRadius="4">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition
                          Width="Auto" />
                        <ColumnDefinition
                          Width="*" />
                        <ColumnDefinition
                          Width="Auto" />
                      </Grid.ColumnDefinitions>
                      <TextBlock
                        Text="æ ¸å¿ƒä¹¦é¡µ:"
                        VerticalAlignment="Center"
                        Opacity="0.7"
                        Margin="0,0,10,0" />
                      <ComboBox
                        Grid.Column="1"
                        SelectedValuePath="GlobalId"
                        DisplayMemberPath="DisplayName"
                        Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                        materialDesign:HintAssist.Hint="é€‰æ‹©ä¹¦é¡µ..."
                        IsEditable="True"
                        ItemsSource="{Binding DataContext.Manager.BookRepo.Items, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        SelectedValue="{Binding ItemId, UpdateSourceTrigger=PropertyChanged}" />
                      <Button
                        Grid.Column="2"
                        Style="{StaticResource MaterialDesignToolButton}"
                        Foreground="#FF5252"
                        Height="24"
                        Width="24"
                        Margin="10,0,0,0"
                        Content="{materialDesign:PackIcon Kind=Close}"
                        Command="{Binding DataContext.RemoveDropCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        CommandParameter="{Binding}" />
                    </Grid>
                  </materialDesign:Card>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Expander>
        <Expander
          Header="ðŸƒ æŽ‰è½æˆ˜æ–—ä¹¦é¡µ (Card Drops)"
          IsExpanded="True"
          Margin="0,0,0,15">
          <StackPanel
            Margin="0,15,0,0">
            <Button
              Content="ä¸ºæœ¬ä¹¦ç±åˆ›å»ºå¡ç‰ŒæŽ‰è½è¡¨"
              HorizontalAlignment="Left"
              Command="{Binding DataContext.CreateCardDropCommand, RelativeSource={RelativeSource AncestorType=UserControl}}">
              <FrameworkElement.Style>
                <Style
                  BasedOn="{StaticResource MaterialDesignRaisedButton}"
                  TargetType="{x:Type Button}">
                  <Setter
                    Property="Visibility"
                    Value="Collapsed" />
                  <Style.Triggers>
                    <DataTrigger
                      Binding="{Binding DataContext.CurrentCardDrop, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Value="{x:Null}">
                      <Setter
                        Property="Visibility"
                        Value="Visible" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </FrameworkElement.Style>
            </Button>
            <Grid>
              <FrameworkElement.Style>
                <Style
                  TargetType="{x:Type Grid}">
                  <Setter
                    Property="Visibility"
                    Value="Visible" />
                  <Style.Triggers>
                    <DataTrigger
                      Binding="{Binding DataContext.CurrentCardDrop, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Value="{x:Null}">
                      <Setter
                        Property="Visibility"
                        Value="Collapsed" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </FrameworkElement.Style>
              <Grid.RowDefinitions>
                <RowDefinition
                  Height="Auto" />
                <RowDefinition
                  Height="Auto" />
              </Grid.RowDefinitions>
              <DockPanel
                Grid.Row="0"
                Margin="0,0,0,15">
                <Button
                  DockPanel.Dock="Right"
                  Content="æ·»åŠ "
                  Style="{StaticResource MaterialDesignOutlinedButton}"
                  Padding="10,4"
                  Margin="10,0,0,0"
                  Height="30"
                  Command="{Binding DataContext.AddCardDropCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                <ComboBox
                  x:Name="CardSelector"
                  DisplayMemberPath="DisplayName"
                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                  materialDesign:HintAssist.Hint="æœç´¢å¹¶æ·»åŠ æˆ˜æ–—ä¹¦é¡µ..."
                  IsEditable="True"
                  ItemsSource="{Binding DataContext.Manager.CardRepo.Items, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  SelectedItem="{Binding DataContext.SelectedCardToAdd, RelativeSource={RelativeSource AncestorType=UserControl}}" />
              </DockPanel>
              <materialDesign:Card
                Grid.Row="1"
                Control.Background="#1AFFFFFF"
                Control.Padding="10"
                UniformCornerRadius="4"
                materialDesign:ElevationAssist.Elevation="Dp0">
                <ItemsControl
                  ItemsSource="{Binding DataContext.CurrentCardDrop.CardIds, RelativeSource={RelativeSource AncestorType=UserControl}}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <WrapPanel />
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <materialDesign:Chip
                        IsDeletable="True"
                        FrameworkElement.Margin="0,0,8,8"
                        ContentControl.Content="{Binding}"
                        DeleteCommand="{Binding DataContext.RemoveCardDropCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        DeleteCommandParameter="{Binding}" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </materialDesign:Card>
            </Grid>
          </StackPanel>
        </Expander>
        <TextBlock
          Height="50" />
      </StackPanel>
    </ScrollViewer>
  </Grid>
</controls:UserControl>
