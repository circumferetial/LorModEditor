<controls:UserControl
  x:Class="Synthesis.Feature.Enemy.EnemyEditorView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:prism="http://prismlibrary.com/"
  xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
  x:Name="Root"
  prism:ViewModelLocator.AutoWireViewModel="True"
  TextElement.Foreground="{DynamicResource MaterialDesignBody}"
  xmlns:controls="clr-namespace:System.Windows.Controls;assembly=PresentationFramework">
  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition
        Width="260" />
      <ColumnDefinition
        Width="*" />
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition
        Height="Auto" />
      <RowDefinition
        Height="*" />
    </Grid.RowDefinitions>
    <Border
      Grid.Row="0"
      Grid.ColumnSpan="2"
      Background="{DynamicResource MaterialDesignPaper}"
      BorderBrush="{DynamicResource MaterialDesignDivider}"
      BorderThickness="0,0,0,1"
      Padding="8,4">
      <StackPanel
        Orientation="Horizontal">
        <Button
          Content="âž• æ–°å»ºæ•Œäºº"
          Style="{StaticResource MaterialDesignRaisedButton}"
          Margin="0,0,10,0"
          Padding="12,6"
          Command="{Binding CreateCommand}"
          IsEnabled="{Binding Manager.EnemyRepo.HasModData}" />
        <Button
          Content="ðŸ—‘ï¸ åˆ é™¤æ•Œäºº"
          Style="{StaticResource MaterialDesignOutlinedButton}"
          Foreground="#FF5252"
          BorderBrush="#FF5252"
          Padding="12,6"
          Margin="0,0,10,0"
          Command="{Binding DeleteCommand}" />
      </StackPanel>
    </Border>
    <DockPanel
      Grid.Row="1"
      Grid.Column="0">
      <TextBox
        x:Name="SearchBox"
        DockPanel.Dock="Top"
        Margin="4"
        Padding="4"
        materialDesign:HintAssist.Hint="æœç´¢ ID æˆ– åç§°..."
        Style="{StaticResource MaterialDesignOutlinedTextBox}"
        TextChanged="SearchBox_TextChanged" />
      <ListBox
        x:Name="EnemyList"
        VirtualizingPanel.IsVirtualizing="True"
        VirtualizingPanel.VirtualizationMode="Recycling"
        DisplayMemberPath="DisplayName"
        BorderThickness="0,1,1,0"
        BorderBrush="{DynamicResource MaterialDesignDivider}"
        ItemsSource="{Binding Manager.EnemyRepo.Items}"
        SelectedItem="{Binding SelectedItem}"
        SelectionChanged="EnemyList_SelectionChanged" />
    </DockPanel>
    <ScrollViewer
      x:Name="ScrollViewer"
      Grid.Row="1"
      Grid.Column="1"
      VerticalScrollBarVisibility="Auto">
      <StackPanel
        x:Name="EditPanel"
        Margin="30"
        DataContext="{Binding SelectedItem}">
        <FrameworkElement.Style>
          <Style
            TargetType="{x:Type StackPanel}">
            <Setter
              Property="Visibility"
              Value="Visible" />
            <Style.Triggers>
              <DataTrigger
                Binding="{Binding}"
                Value="{x:Null}">
                <Setter
                  Property="Visibility"
                  Value="Hidden" />
              </DataTrigger>
              <DataTrigger
                Value="True"
                Binding="{Binding IsVanilla}">
                <Setter
                  Property="IsEnabled"
                  Value="False" />
                <Setter
                  Property="UIElement.Opacity"
                  Value="0.6" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </FrameworkElement.Style>
        <TextBlock
          Text="æ•Œäººå•ä½ç¼–è¾‘ (Enemy Unit)"
          FontSize="22"
          FontWeight="Bold"
          Margin="0,0,0,25" />
        <Expander
          Header="âš™ï¸ åŸºç¡€å‚æ•° (Basic)"
          IsExpanded="True"
          Margin="0,0,0,15">
          <StackPanel
            Margin="0,15,0,0">
            <Grid
              Margin="0,0,0,15">
              <Grid.ColumnDefinitions>
                <ColumnDefinition
                  Width="*" />
                <ColumnDefinition
                  Width="20" />
                <ColumnDefinition
                  Width="*" />
              </Grid.ColumnDefinitions>
              <TextBox
                Grid.Column="0"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                materialDesign:HintAssist.Hint="ID"
                Text="{Binding Id, UpdateSourceTrigger=PropertyChanged}" />
              <TextBox
                Grid.Column="2"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                materialDesign:HintAssist.Hint="Name (åç§°)"
                Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" />
            </Grid>
            <Grid
              Margin="0,0,0,15">
              <Grid.ColumnDefinitions>
                <ColumnDefinition
                  Width="*" />
                <ColumnDefinition
                  Width="20" />
                <ColumnDefinition
                  Width="*" />
              </Grid.ColumnDefinitions>
              <TextBox
                Grid.Column="0"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                materialDesign:HintAssist.Hint="NameID (ç¿»è¯‘ID)"
                ToolTip="é»˜è®¤ä¸ŽIDç›¸åŒ"
                Text="{Binding NameId, UpdateSourceTrigger=PropertyChanged}" />
              <StackPanel
                Grid.Column="2">
                <TextBlock
                  Text="Height Range (èº«é«˜èŒƒå›´)"
                  FontSize="10"
                  Opacity="0.6" />
                <StackPanel
                  Orientation="Horizontal">
                  <TextBox
                    Width="60"
                    Style="{StaticResource MaterialDesignTextBox}"
                    HorizontalContentAlignment="Center"
                    Text="{Binding MinHeight, UpdateSourceTrigger=PropertyChanged}" />
                  <TextBlock
                    Text=" - "
                    VerticalAlignment="Center"
                    Margin="5,0" />
                  <TextBox
                    Width="60"
                    Style="{StaticResource MaterialDesignTextBox}"
                    HorizontalContentAlignment="Center"
                    Text="{Binding MaxHeight, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
              </StackPanel>
            </Grid>
            <Grid
              Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition
                  Width="*" />
                <ColumnDefinition
                  Width="Auto" />
              </Grid.ColumnDefinitions>
              <ComboBox
                Grid.Column="0"
                SelectedValuePath="GlobalId"
                DisplayMemberPath="DisplayName"
                Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                materialDesign:HintAssist.Hint="Equip Page (æ ¸å¿ƒä¹¦é¡µ)"
                IsEditable="True"
                SelectedValue="{Binding BookId, UpdateSourceTrigger=PropertyChanged}"
                ItemsSource="{Binding DataContext.Manager.BookRepo.Items, ElementName=Root}" />
              <Button
                Grid.Column="1"
                Content="æ¸…é™¤"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                Foreground="#FF808080"
                BorderBrush="#FF808080"
                Margin="10,0,0,0"
                Padding="10,4"
                VerticalAlignment="Bottom"
                Click="ClearBook_Click" />
            </Grid>
          </StackPanel>
        </Expander>
        <Expander
          Header="ðŸŽ è¡Œä¸ºä¸ŽæŽ‰è½ (Drops)"
          IsExpanded="True"
          Margin="0,0,0,15">
          <StackPanel
            Margin="0,15,0,0">
            <Grid
              Margin="0,0,0,15">
              <Grid.ColumnDefinitions>
                <ColumnDefinition
                  Width="Auto" />
                <ColumnDefinition
                  Width="20" />
                <ColumnDefinition
                  Width="*" />
              </Grid.ColumnDefinitions>
              <CheckBox
                Grid.Column="0"
                Content="æ­»äº¡æ—¶æ’¤é€€ (Retreat)"
                Style="{StaticResource MaterialDesignSecondaryCheckBox}"
                IsChecked="{Binding Retreat, UpdateSourceTrigger=PropertyChanged}" />
              <TextBox
                Grid.Column="2"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                materialDesign:HintAssist.Hint="Drop Level (æŽ‰è½ç­‰çº§)"
                Text="{Binding DropLevel, UpdateSourceTrigger=PropertyChanged}" />
            </Grid>
            <Grid
              Margin="0,0,0,10">
              <TextBlock
                Text="Books (ä¹¦ç±æŽ‰è½)"
                VerticalAlignment="Bottom"
                FontWeight="Bold"
                Opacity="0.6" />
              <Button
                HorizontalAlignment="Right"
                Content="âž• æ·»åŠ ä¹¦ç±"
                Style="{StaticResource MaterialDesignOutlinedButton}"
                Padding="10,4"
                Height="28"
                Command="{Binding DataContext.AddDropCommand, ElementName=Root}" />
            </Grid>
            <ItemsControl
              ItemsSource="{Binding Drops}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <materialDesign:Card
                    FrameworkElement.Margin="0,0,0,8"
                    Control.Padding="8"
                    Control.Background="{DynamicResource MaterialDesignPaper}"
                    UniformCornerRadius="4">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition
                          Width="Auto" />
                        <ColumnDefinition
                          Width="10" />
                        <ColumnDefinition
                          Width="*" />
                        <ColumnDefinition
                          Width="Auto" />
                      </Grid.ColumnDefinitions>
                      <TextBox
                        Grid.Column="0"
                        Style="{StaticResource MaterialDesignOutlinedTextBox}"
                        materialDesign:HintAssist.Hint="Prob"
                        Width="70"
                        VerticalAlignment="Center"
                        Padding="4"
                        Text="{Binding Prob, UpdateSourceTrigger=PropertyChanged}" />
                      <ComboBox
                        Grid.Column="2"
                        SelectedValuePath="GlobalId"
                        DisplayMemberPath="DisplayName"
                        IsEditable="True"
                        Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                        materialDesign:HintAssist.Hint="é€‰æ‹©æŽ‰è½ä¹¦ç±..."
                        ItemsSource="{Binding DataContext.Manager.DropBookRepo.Items, ElementName=Root}"
                        SelectedValue="{Binding BookId, UpdateSourceTrigger=PropertyChanged}" />
                      <Button
                        Grid.Column="3"
                        Style="{StaticResource MaterialDesignToolButton}"
                        Foreground="#FF5252"
                        Height="30"
                        Width="30"
                        Margin="10,0,0,0"
                        Content="{materialDesign:PackIcon Kind=Close}"
                        Command="{Binding DataContext.RemoveDropCommand, ElementName=Root}"
                        CommandParameter="{Binding}" />
                    </Grid>
                  </materialDesign:Card>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Expander>
        <Expander
          Header="ðŸƒ å¡ç»„æž„å»º (Deck)"
          IsExpanded="True"
          Margin="0,0,0,15">
          <materialDesign:Card
            FrameworkElement.Margin="0,10,0,0"
            Control.Background="#1AFFFFFF"
            UniformCornerRadius="8"
            materialDesign:ElevationAssist.Elevation="Dp0">
            <Border
              BorderBrush="{DynamicResource MaterialDesignDivider}"
              BorderThickness="1"
              CornerRadius="8"
              Padding="15">
              <Grid
                Height="350">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition
                    Width="*" />
                  <ColumnDefinition
                    Width="80" />
                  <ColumnDefinition
                    Width="*" />
                </Grid.ColumnDefinitions>
                <DockPanel
                  Grid.Column="0">
                  <StackPanel
                    DockPanel.Dock="Top"
                    Orientation="Horizontal"
                    Margin="0,0,0,8">
                    <materialDesign:PackIcon
                      Kind="CardsPlaying"
                      Foreground="#FFCA28"
                      FrameworkElement.VerticalAlignment="Center"
                      FrameworkElement.Margin="0,0,8,0" />
                    <TextBlock
                      Text="å½“å‰æŒæœ‰ (Deck)"
                      FontWeight="Bold"
                      Foreground="#FFCA28"
                      FontSize="14" />
                  </StackPanel>
                  <Border
                    BorderBrush="#FFCA28"
                    BorderThickness="1"
                    CornerRadius="4"
                    Background="#121212">
                    <ListBox
                      x:Name="CurrentDeckList"
                      Background="#00FFFFFF"
                      Padding="0"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      ItemsSource="{Binding DeckCardIds}">
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <Border
                            Padding="12,8"
                            Background="#00FFFFFF"
                            Cursor="Hand"
                            ToolTip="åŒå‡»ç§»é™¤"
                            BorderBrush="#333"
                            BorderThickness="0,0,0,1">
                            <UIElement.InputBindings>
                              <MouseBinding
                                Gesture="LeftDoubleClick"
                                Command="{Binding DataContext.RemoveCardFromDeckCommand, ElementName=Root}"
                                CommandParameter="{Binding}" />
                            </UIElement.InputBindings>
                            <Grid>
                              <TextBlock
                                VerticalAlignment="Center"
                                FontWeight="Medium"
                                Foreground="{DynamicResource MaterialDesignBody}"
                                Text="{Binding}" />
                            </Grid>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ListBox>
                  </Border>
                </DockPanel>
                <StackPanel
                  Grid.Column="1"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center"
                  Opacity="0.7">
                  <materialDesign:PackIcon
                    Kind="SwapHorizontalCircle"
                    FrameworkElement.Width="40"
                    FrameworkElement.Height="40"
                    Foreground="#FF808080"
                    FrameworkElement.Margin="0,0,0,5" />
                  <TextBlock
                    Text="åŒå‡»ç§»åŠ¨"
                    FontSize="12"
                    Foreground="#FF808080"
                    HorizontalAlignment="Center" />
                  <TextBlock
                    Text="Double Click"
                    FontSize="10"
                    Foreground="#FF808080"
                    HorizontalAlignment="Center" />
                </StackPanel>
                <DockPanel
                  Grid.Column="2">
                  <StackPanel
                    DockPanel.Dock="Top"
                    Orientation="Horizontal"
                    Margin="0,0,0,8">
                    <materialDesign:PackIcon
                      Kind="Library"
                      Foreground="#FF00FFFF"
                      FrameworkElement.VerticalAlignment="Center"
                      FrameworkElement.Margin="0,0,8,0" />
                    <TextBlock
                      Text="å¡ç‰Œåº“ (Library)"
                      FontWeight="Bold"
                      Foreground="#FF00FFFF"
                      FontSize="14" />
                  </StackPanel>
                  <Border
                    BorderBrush="#FF00FFFF"
                    BorderThickness="1"
                    CornerRadius="4"
                    Background="#121212">
                    <ListBox
                      x:Name="LibraryCardList"
                      Background="#00FFFFFF"
                      Padding="0"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      ItemsSource="{Binding DataContext.Manager.CardRepo.Items, ElementName=Root}">
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <Border
                            Padding="12,8"
                            Background="#00FFFFFF"
                            Cursor="Hand"
                            ToolTip="åŒå‡»æ·»åŠ "
                            BorderBrush="#333"
                            BorderThickness="0,0,0,1">
                            <UIElement.InputBindings>
                              <MouseBinding
                                Gesture="LeftDoubleClick"
                                Command="{Binding DataContext.AddCardToDeckCommand, ElementName=Root}"
                                CommandParameter="{Binding}" />
                            </UIElement.InputBindings>
                            <Grid>
                              <materialDesign:PackIcon
                                Kind="ArrowLeftBold"
                                FrameworkElement.HorizontalAlignment="Left"
                                Foreground="#FF00FFFF"
                                UIElement.Opacity="0.5" />
                              <TextBlock
                                Margin="24,0,0,0"
                                VerticalAlignment="Center"
                                Foreground="{DynamicResource MaterialDesignBody}"
                                Text="{Binding DisplayName}" />
                            </Grid>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ListBox>
                  </Border>
                </DockPanel>
              </Grid>
            </Border>
          </materialDesign:Card>
        </Expander>
        <TextBlock
          Height="50" />
      </StackPanel>
    </ScrollViewer>
  </Grid>
</controls:UserControl>
