<UserControl x:Class="Synthesis.Feature.Passive.PassiveEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"

             xmlns:prism="http://prismlibrary.com/"

             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:passive="clr-namespace:Synthesis.Feature.Passive"
             xmlns:core="clr-namespace:Synthesis.Core"

             mc:Ignorable="d"
             prism:ViewModelLocator.AutoWireViewModel="True"
             d:DataContext="{d:DesignInstance Type=passive:PassiveEditorViewModel, IsDesignTimeCreatable=False}"

             d:DesignHeight="600" d:DesignWidth="900"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 1. å·¥å…·æ  -->
        <Border Grid.Row="0" Grid.ColumnSpan="2"
                Background="{DynamicResource MaterialDesignPaper}"
                BorderBrush="{DynamicResource MaterialDesignDivider}"
                BorderThickness="0,0,0,1" Padding="8,4">

            <StackPanel Orientation="Horizontal">
                <!-- æ–°å»ºæŒ‰é’® -->
                <Button Content="âž• æ–°å»ºè¢«åŠ¨" Command="{Binding CreateCommand}"
                        IsEnabled="{Binding Manager.PassiveRepo.HasData}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Margin="0,0,10,0" Padding="12,6" />

                <!-- åˆ é™¤æŒ‰é’® -->
                <Button Content="ðŸ—‘ï¸ åˆ é™¤è¢«åŠ¨" Command="{Binding DeleteCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Foreground="#FF5252" BorderBrush="#FF5252"
                        Padding="12,6" Margin="0,0,10,0" />
            </StackPanel>
        </Border>

        <!-- 2. å·¦ä¾§åˆ—è¡¨ -->
        <DockPanel Grid.Row="1" Grid.Column="0">
            <!-- æœç´¢æ¡† -->
            <TextBox x:Name="SearchBox" DockPanel.Dock="Top"
                     TextChanged="SearchBox_TextChanged"
                     Margin="4" Padding="4"
                     materialDesign:HintAssist.Hint="æœç´¢ ID æˆ– åç§°..."
                     Style="{StaticResource MaterialDesignOutlinedTextBox}" />

            <ListBox x:Name="PassiveListBox"
                     VirtualizingStackPanel.IsVirtualizing="True"
                     VirtualizingStackPanel.VirtualizationMode="Recycling"
                     ItemsSource="{Binding Manager.PassiveRepo.Items}"
                     SelectedItem="{Binding SelectedItem}"
                     DisplayMemberPath="DisplayName"
                     BorderThickness="0,1,1,0"
                     BorderBrush="{DynamicResource MaterialDesignDivider}" />
        </DockPanel>

        <!-- 3. å³ä¾§ç¼–è¾‘åŒº -->
        <ScrollViewer Grid.Row="1" Grid.Column="1" VerticalScrollBarVisibility="Auto">

            <StackPanel x:Name="EditPanel" Margin="30" DataContext="{Binding SelectedItem}">

                <!-- æ ·å¼è§¦å‘å™¨ -->
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Hidden" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsVanilla}" Value="True">
                                <Setter Property="IsEnabled" Value="False" />
                                <Setter Property="Opacity" Value="0.6" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>

                <TextBlock Text="è¢«åŠ¨èƒ½åŠ›ç¼–è¾‘ (Passive)" FontSize="22" FontWeight="Bold" Margin="0,0,0,25" />

                <!-- 1. åŸºç¡€å‚æ•°é…ç½® (Data) -->
                <Expander Header="âš™ï¸ åŸºç¡€å‚æ•° (Data)" IsExpanded="True" Margin="0,0,0,15">
                    <StackPanel Margin="0,15,0,0">

                        <!-- ID & Cost -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1.5*" />
                                <ColumnDefinition Width="20" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0" Text="{Binding Id, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                     materialDesign:HintAssist.Hint="ID" />

                            <TextBox Grid.Column="2" Text="{Binding Cost, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                     materialDesign:HintAssist.Hint="Cost (è´¹ç”¨)" />
                        </Grid>

                        <!-- Rarity & Transfer -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="20" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <ComboBox Grid.Column="0" ItemsSource="{x:Static core:GlobalValues.Rarities}"
                                      SelectedItem="{Binding Rarity, UpdateSourceTrigger=PropertyChanged}"
                                      Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                      materialDesign:HintAssist.Hint="Rarity (ç¨€æœ‰åº¦)" />

                            <CheckBox Grid.Column="2" Content="å¯å½’å±ž (CanGivePassive)"
                                      IsChecked="{Binding CanGivePassive, UpdateSourceTrigger=PropertyChanged}"
                                      Style="{StaticResource MaterialDesignSecondaryCheckBox}"
                                      VerticalAlignment="Bottom" Margin="0,0,0,5" />
                        </Grid>

                        <!-- InnerType & Script -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="20" />
                                <ColumnDefinition Width="2*" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0" Text="{Binding InnerTypeId, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                     materialDesign:HintAssist.Hint="InnerType (äº’æ–¥ç»„ID)"
                                     ToolTip="-1 è¡¨ç¤ºæ— é™åˆ¶ï¼›ç›¸åŒæ­£æ•´æ•° ID çš„è¢«åŠ¨ä¸èƒ½åŒæ—¶è£…å¤‡" />

                            <ComboBox Grid.Column="2" IsEditable="True"
                                      Text="{Binding Script, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding DataContext.Manager.ScriptScanner.PassiveScripts, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                      Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                      materialDesign:HintAssist.Hint="Script (è„šæœ¬ç±»å)"
                                      ToolTip="é€šå¸¸ç•™ç©ºï¼Œé™¤éžä½ æœ‰è‡ªå®šä¹‰C#ä»£ç " />
                        </Grid>

                    </StackPanel>
                </Expander>

                <!-- 2. æœ¬åœ°åŒ–æ–‡æœ¬é…ç½® -->
                <Expander Header="ðŸ“ æœ¬åœ°åŒ–æ–‡æœ¬ (Localization)" IsExpanded="True" Margin="0,0,0,15">
                    <StackPanel Margin="0,15,0,0">

                        <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                 materialDesign:HintAssist.Hint="Name (æ˜¾ç¤ºåç§°)"
                                 Margin="0,0,0,20" />

                        <TextBox Text="{Binding Desc, UpdateSourceTrigger=PropertyChanged}"
                                 Height="120"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Desc (èƒ½åŠ›æè¿°)"
                                 Padding="10" />
                    </StackPanel>
                </Expander>

                <!-- åº•éƒ¨ç•™ç™½ -->
                <TextBlock Height="50" />

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>