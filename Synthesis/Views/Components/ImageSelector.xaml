<UserControl x:Class="Synthesis.Views.Components.ImageSelector"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="200" d:DesignWidth="300"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}">

    <Grid>
        <StackPanel>
            <!-- 
               输入框区域 
               1. 使用 FloatingHint 替代原来的 TextBlock 标题，保持表单整洁。
               2. 绑定 Hint 到 LabelText 属性。
            -->
            <ComboBox x:Name="ImageCombo"
                      Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                      materialDesign:HintAssist.Hint="{Binding LabelText, RelativeSource={RelativeSource AncestorType=UserControl}, FallbackValue='Image Name'}"

                      IsEditable="True"
                      StaysOpenOnEdit="True"
                      IsTextSearchEnabled="False"
                      Margin="0,0,0,10"

                      ItemsSource="{Binding ImageList, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Text="{Binding SelectedImageName, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"

                      TextBoxBase.TextChanged="ImageCombo_TextChanged"
                      SelectionChanged="ImageCombo_SelectionChanged" />

            <!-- 
               预览图区域 
               1. 边框颜色使用 Divider。
               2. 增加 ClipToBounds 确保图片不会遮挡圆角。
               3. 增加一个默认的半透明背景，方便查看透明图片。
            -->
            <Border BorderBrush="{DynamicResource MaterialDesignDivider}"
                    BorderThickness="1"
                    CornerRadius="4"
                    ClipToBounds="True"
                    HorizontalAlignment="Left"
                    Background="{DynamicResource MaterialDesignPaper}"
                    Width="{Binding PreviewWidth, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Height="{Binding PreviewHeight, RelativeSource={RelativeSource AncestorType=UserControl}}">

                <Grid>
                    <!-- 可选：棋盘格背景 (模拟透明)，如果不需要可以删除这个 Border -->
                    <Border Opacity="0.05">
                        <Border.Background>
                            <DrawingBrush TileMode="Tile" Viewport="0,0,10,10" ViewportUnits="Absolute">
                                <DrawingBrush.Drawing>
                                    <GeometryDrawing Brush="Gray">
                                        <GeometryDrawing.Geometry>
                                            <GeometryGroup>
                                                <RectangleGeometry Rect="0,0,5,5" />
                                                <RectangleGeometry Rect="5,5,5,5" />
                                            </GeometryGroup>
                                        </GeometryDrawing.Geometry>
                                    </GeometryDrawing>
                                </DrawingBrush.Drawing>
                            </DrawingBrush>
                        </Border.Background>
                    </Border>

                    <!-- 图片控件 -->
                    <Image x:Name="PreviewImage"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality" />
                </Grid>
            </Border>
        </StackPanel>
    </Grid>
</UserControl>