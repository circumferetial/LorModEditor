# Quality Audit Report

- Generated: 2026-02-18 21:35:32 +08:00
- Branch: Backup
- Baseline SHA: d36f33094f85c33f377116bdce6c49e26255ca4c (d36f330)
- Working tree dirty: True

## Gate A — Baseline Freeze
- Baseline metadata written to docs\quality\reports\baseline.json
- Assembly parity: Local compiled assembly not found: D:\C# Projects\LorModEditor\Synthesis\bin\Release\net10.0-windows\Synthesis.dll

## Gate B — Automated Static Audit
- Build failed: True
- Warning count: 0
- Error count: 186

### Pattern Scan Summary
- async void: 2
- empty catch block: 0
- catch without exception variable: 1
- Task.Run usage: 1
- MessageBox usage: 61
- lock statement: 1
- Core Abstraction namespace (for layering checks): 3

### Largest Files (Top 10)
- Synthesis\Feature\SkinEditor\SkinEditorViewModel.cs: 495 lines
- Synthesis\Feature\SkinEditor\SkinEditorView.xaml.cs: 388 lines
- Synthesis\Feature\SkinEditor\SkinCompatibilityGuard.cs: 346 lines
- Synthesis\Feature\SkinEditor\SkinRepository.cs: 346 lines
- Synthesis\Feature\Book\UnifiedBook.cs: 323 lines
- Synthesis\Feature\Enemy\UnifiedEnemy.cs: 256 lines
- Synthesis\Feature\Card\UnifiedCard.cs: 242 lines
- Synthesis\Feature\Stage\UnifiedStage.cs: 237 lines
- Synthesis\Core\ProjectManager.cs: 220 lines
- Synthesis\Feature\Card\CardEditorViewModel.cs: 216 lines

### Method-Heavy Files (Top 10)
- Synthesis\Core\Abstraction\XWrapper.cs: 26 methods
- Synthesis\Feature\SkinEditor\SkinEditorViewModel.cs: 20 methods
- Synthesis\Core\Abstraction\BaseRepository.cs: 19 methods
- Synthesis\Feature\SkinEditor\SkinEditorView.xaml.cs: 17 methods
- Synthesis\Feature\SkinEditor\SkinRepository.cs: 16 methods
- Synthesis\Feature\SkinEditor\SkinCompatibilityGuard.cs: 14 methods
- Synthesis\Feature\Stage\UnifiedStage.cs: 13 methods
- Synthesis\Feature\Card\UnifiedCard.cs: 12 methods
- Synthesis\Feature\Stage\StageEditorView.xaml.cs: 11 methods
- Synthesis\Feature\Enemy\UnifiedEnemy.cs: 11 methods

### Project Quality Baseline
- .editorconfig present: True
- Directory.Build.props present: True
- Test projects found: 1

## Gate C — Manual Deep Review Targets
- Repository/domain layering: check MessageBox usage in Core/Repository paths
- Error handling observability: replace silent catches and popup-only failures with structured logging
- Concurrency/lifecycle: migrate async void command paths to async Task patterns
- Maintainability hotspots: split SkinEditorViewModel/SkinEditorView code-behind and simplify orchestration in ProjectManager

## Findings
Format: `P级 | 文件:行 | 问题 | 影响 | 建议修复`
- P0 | Build Gate B | Release build failed | Cannot trust audit results until build baseline is green | Resolve compile errors, then rerun audit and parity checks
- P1 | Synthesis\Core\Abstraction\BaseRepository.cs:126 | UI interaction inside repository/core data path | Layering leakage, difficult unit testing and reuse | Move interaction to viewmodel/service; repositories return result objects or domain errors
- P1 | Synthesis\Core\Abstraction\BaseRepository.cs:126 | Repository base class displays MessageBox directly | Data access layer depends on UI and cannot be cleanly reused/tested | Replace popup calls with structured error returns/logging; let ViewModel decide UI prompts
- P1 | Synthesis\Core\Abstraction\BaseRepository.cs:151 | UI interaction inside repository/core data path | Layering leakage, difficult unit testing and reuse | Move interaction to viewmodel/service; repositories return result objects or domain errors
- P1 | Synthesis\Core\Tools\UnityRichTextHelper.cs:136 | Catch block without exception variable in UnityRichTextHelper | Color parsing failures are silent and diagnostics are lost | Log parse failures at debug level with input context, then fallback safely
- P1 | Synthesis\Feature\MainWindow\MainWindowViewModel.cs:51 | async void command/event chain in viewmodel | Unhandled exceptions bypass normal flow and are harder to test | Use async Task command handlers and central exception pipeline
- P1 | Synthesis\Feature\Setting\SettingsViewModel.cs:40 | async void command/event chain in viewmodel | Unhandled exceptions bypass normal flow and are harder to test | Use async Task command handlers and central exception pipeline
- P1 | Synthesis\Feature\SkinEditor\SkinRepository.cs:207 | UI interaction inside repository/core data path | Layering leakage, difficult unit testing and reuse | Move interaction to viewmodel/service; repositories return result objects or domain errors
- P1 | Synthesis\Feature\SkinEditor\SkinRepository.cs:207 | SkinRepository performs save-time interactive UI decisions | Repository side effects complicate batch processing and error automation | Move user decision flow to ViewModel/service and keep repository side-effect free
- P2 | Synthesis\Feature\SkinEditor\SkinEditorViewModel.cs | Very large file with concentrated responsibilities | High maintenance cost and regression probability | Split into focused services/helpers and keep viewmodel slim

## Open Questions
- Should repository-layer user prompts be migrated to ViewModel immediately (batch 1), or behind a staged adapter?
- For async command migration, do we standardize on Prism Async DelegateCommand wrappers in this cycle?
- Is strict DLL parity required after every remediation commit, or only at batch boundaries?

## Remediation Plan
1. Batch 1 (P0/P1): compile blockers, exception visibility, async command safety, remove repository-layer UI prompts
2. Batch 2 (P2): split oversized classes, reduce orchestration coupling, add result/error transport contracts
3. Batch 3 (P3): naming/style consistency and low-risk cleanup

### Regression and Acceptance
- Rebuild Release for both projects after each batch
- Re-run audit script and compare finding counts
- Re-run DLL parity checks at batch boundary commits
